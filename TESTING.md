# Тестирование сканера локальных администраторов

## Быстрый тест функциональности

### 1. Тест на локальной машине
```bash
# Запустите приложение
dotnet run
# ИЛИ
.\bin\Debug\net8.0-windows\who_admin.exe
```

**В поле "Компьютеры" введите:**
```
localhost
.
127.0.0.1
```

**Ожидаемый результат:** Должны отобразиться все члены локальной группы Администраторы

### 2. Тест разрешения имени группы по SID
Приложение должно автоматически найти локализованное имя группы "Администраторы" независимо от языка ОС:
- **English:** "Administrators" 
- **Русский:** "Администраторы"
- **Deutsch:** "Administratoren"
- **Français:** "Administrateurs"

### 3. Проверка типов учётных записей

**Ожидаемые типы членов:**
- ✅ **Локальный пользователь** - `МАШИНА\Administrator`
- ✅ **Доменный пользователь** - `DOMAIN\username`
- ✅ **Локальная группа** - `МАШИНА\LocalGroup`
- ✅ **Доменная группа** - `DOMAIN\Domain Admins`
- ✅ **Встроенная группа** - встроенные группы системы
- ✅ **Компьютер домена** - если есть компьютерные учётки

### 4. Проверка статуса учётных записей

**Для доменных пользователей ожидаются статусы:**
- `[ОТКЛЮЧЁН]` - для отключенных учёток
- `[ЗАБЛОКИРОВАН]` - для заблокированных учёток  
- `[ПАРОЛЬ НЕ ИСТЕКАЕТ]` - для служебных учёток

### 5. Тест разворачивания доменных групп

1. ✅ Установите галочку **"Разворачивать доменные группы"**
2. Запустите сканирование
3. **Ожидаемый результат:** 
   - Прямые члены: `DOMAIN\Domain Admins` (Доменная группа)
   - Развёрнутые члены: `DOMAIN\admin1` (Доменный пользователь из группы) [Развёрнуто из: DOMAIN\Domain Admins]

## Диагностика проблем

### Проблема: "Unable to find an entry point named 'LocalFree' in DLL 'advapi32.dll'"
**Статус:** ✅ **ИСПРАВЛЕНО** в коммите `d57ee73`
- Перекачайте последнюю версию с GitHub
- Пересоберите проект: `dotnet build`

### Проблема: Доменные группы не отображаются
**Решение:** ✅ **ИСПРАВЛЕНО** переходом на NetAPI32
- Старая WMI версия имела ограничения
- Новая NetAPI32 версия показывает ВСЕ члены

### Проблема: "Доступ запрещён" при сканировании удалённых ПК
**Требования:**
- Запуск от учётки с правами доменного администратора
- Открытые порты 135, 445 на целевых машинах
- Включенное правило брандмауэра "Remote Administration"

### Проблема: "Компьютер недоступен"
**Проверка:**
```cmd
# Тест доступности
ping COMPUTER_NAME

# Тест RPC
telnet COMPUTER_NAME 135

# Тест SMB
net use \\COMPUTER_NAME\C$ /delete
net use \\COMPUTER_NAME\C$
```

## Примеры ожидаемых результатов

### Успешное сканирование:
```
Компьютер | Статус | Тип члена                    | Учетная запись              | Источник
----------|--------|------------------------------|-----------------------------|-----------
PC001     | OK     | Локальный пользователь       | PC001\Administrator         | NetAPI32
PC001     | OK     | Доменный пользователь        | DOMAIN\john.doe             | NetAPI32  
PC001     | OK     | Доменная группа              | DOMAIN\Domain Admins        | NetAPI32
PC001     | OK     | Встроенная группа            | BUILTIN\Backup Operators    | NetAPI32
PC001     | OK     | Доменный пользователь [ОТКЛЮЧЁН] | DOMAIN\old.admin        | NetAPI32
```

### С разворачиванием групп:
```
Компьютер | Тип члена                           | Учетная запись | Развёрнуто из
----------|-------------------------------------|----------------|------------------
PC001     | Доменная группа                     | DOMAIN\Domain Admins | 
PC001     | Доменный пользователь (из группы)   | DOMAIN\admin1  | DOMAIN\Domain Admins
PC001     | Доменный пользователь (из группы)   | DOMAIN\admin2  | DOMAIN\Domain Admins
```

## Логи и отладка

### Важные сообщения об ошибках:
- ✅ **"Источник: NetAPI32"** - правильный источник данных
- ❌ **"Источник: WMI"** - устаревшая версия, обновите код

### Успешная работа показывает:
- Локализованное имя группы найдено по SID S-1-5-32-544
- Все типы членов корректно определены
- Статусы доменных пользователей получены через AD
- Экспорт CSV работает без ошибок

## Производительность

**Рекомендуемые настройки:**
- **Параллельные потоки:** Количество ядер CPU (по умолчанию)
- **Максимум ПК за раз:** До 100-200 (зависит от сети)
- **Тайм-аут:** Встроенный в NetAPI32 (обычно 30 сек)

**Время сканирования:**
- Локальная машина: ~1-2 секунды
- Удалённая машина: ~3-5 секунд  
- 50 машин параллельно: ~30-60 секунд

## Обратная связь

При обнаружении проблем создайте Issue на GitHub с:
- Версией ОС (клиент и целевые машины)
- Типом домена (Windows Server версия)  
- Текстом ошибки
- Скриншотом результатов сканирования
